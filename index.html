<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Wicked Background</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <style>
        body {
            margin: 0;
            background-color: #000;
            overflow: hidden;
            font-family: sans-serif;
        }

        #lava-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #instructions-card {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
            box-sizing: border-box;
            color: white;

            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #instructions-card p { margin: 0; font-size: 0.9rem; }
        
        #close-instructions {
            background: none; border: none; color: white;
            font-size: 1.8rem; font-weight: bold; cursor: pointer;
            padding: 0 0 0 1rem; line-height: 1;
        }
        
        #header-card {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            background: rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 20px;
            width: 85%;
            max-width: 350px;
            box-sizing: border-box;
        }

        .card-view {
            display: none;
            flex-direction: column;
            gap: 1rem;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
        }
        .card-view.active {
            display: flex;
            opacity: 1;
        }

        .header-image { display: block; width: 100%; margin-bottom: 1.5rem; }

        .reg-input, #student-id-login {
            background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px; padding: 12px 15px; font-size: 1rem; color: white;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
        }

        .reg-input:hover, #student-id-login:hover,
        .reg-input:focus, #student-id-login:focus {
            border-color: #60A34D;
            box-shadow: 0 0 15px #60A34D;
        }

        .reg-input::placeholder, #student-id-login::placeholder { color: rgba(255, 255, 255, 0.7); }

        .button-group { display: flex; gap: 0.5rem; }
        
        .button-group button {
            flex: 1; border-radius: 10px; padding: 12px 15px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer;
            border: 2px solid #60A34D; transition: all 0.3s ease;
        }
        
        #register-btn, #submit-btn, #start-btn { background-color: #60A34D; color: white; }
        #signin-btn, #back-btn, #logout-btn { background-color: transparent; color: #60A34D; }

        #signin-btn:hover, #back-btn:hover, #logout-btn:hover { background-color: #60A34D; color: white; box-shadow: 0 0 15px #60A34D; }
        #register-btn:hover, #submit-btn:hover, #start-btn:hover { background-color: #4b823e; border-color: #4b823e; box-shadow: 0 0 15px #60A34D; }
        
        .card-view h3 { color: white; text-align: center; margin: 0 0 0.5rem 0; }
        .card-view p { color: rgba(255, 255, 255, 0.9); text-align: center; margin: 0; font-size: 0.95rem; line-height: 1.4; }

        #leaderboard-link {
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            font-size: 0.9rem;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 0.5rem;
        }

        /* NEW: Styles for the QR Scanner card */
        #qr-reader {
            width: 100%;
            border-radius: 10px;
            border: 2px solid #60A34D;
            box-shadow: 0 0 15px #60A34D; /* Green glow effect */
            overflow: hidden; /* Keeps the camera feed inside the rounded corners */
        }
        
        footer {
            position: absolute; bottom: 0; left: 0; right: 0;
            padding: 10px 10px 20px 10px; color: rgba(255, 255, 255, 0.7); font-size: 0.8rem; z-index: 20;
            display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 10px;
        }

        .footer-logo { height: 40px; width: auto; }
        footer p { margin: 0; text-align: center; }

        #lava-container::before, #lava-container::after {
            content: ''; position: absolute; width: 50vmax; height: 50vmax;
            border-radius: 50%; opacity: 0.6; mix-blend-mode: lighten; filter: blur(100px);
        }
        #lava-container::before {
            background-color: #ff69b4; top: -25vmax; left: -25vmax;
            animation: move-pink 25s infinite linear;
        }
        #lava-container::after {
            background-color: #60A34D; bottom: -25vmax; right: -25vmax;
            animation: move-green 20s infinite linear; animation-delay: -10s;
        }
        @keyframes move-pink {
            0%, 100% { transform: translate(0, 0); } 25% { transform: translate(100vw, 0); }
            50% { transform: translate(100vw, 100vh); } 75% { transform: translate(0, 100vh); }
        }
        @keyframes move-green {
            0%, 100% { transform: translate(0, 0); } 25% { transform: translate(-100vw, 0); }
            50% { transform: translate(-100vw, -100vh); } 75% { transform: translate(0, -100vh); }
        }
    </style>
</head>
<body>

    <div id="instructions-card">
        <p>Tap the <strong>Share</strong> icon (â‡§) to add to your Home Screen!</p>
        <button id="close-instructions">&times;</button>
    </div>

    <div id="lava-container">
        <div id="header-card">
            
            <div id="login-view" class="card-view">
                <img class="header-image" src="https://i.imgur.com/piKjXSd.png" alt="Wicked Movie Header">
                <input type="text" id="student-id-login" placeholder="Student ID">
                <div class="button-group">
                    <button id="signin-btn">Sign In</button>
                    <button id="register-btn">Register</button>
                </div>
                <div id="leaderboard-link">View Leaderboard</div>
            </div>

            <div id="registration-view" class="card-view">
                <h3>Welcome To The Hunt!</h3>
                <input type="text" id="reg-firstname" class="reg-input" placeholder="First Name">
                <input type="text" class="reg-input" placeholder="Last Name">
                <input type="email" class="reg-input" placeholder="Email">
                <input type="text" class="reg-input" placeholder="Student ID">
                <div class="button-group">
                    <button id="back-btn">Back</button>
                    <button id="submit-btn">Submit</button>
                </div>
            </div>

            <div id="how-to-play-view" class="card-view">
                <h3>How To Play</h3>
                <p>Find QR codes hidden around campus and scan them to score points. The hunter with the most points at the end wins!</p>
                <div class="button-group">
                    <button id="logout-btn">Log Out</button>
                    <button id="start-btn">Start Hunting!</button>
                </div>
            </div>
            
            <div id="leaderboard-view" class="card-view">
                <h3>Leaderboard</h3>
                <p>The hunt has not yet begun. Check back here to see the top hunters once the event starts!</p>
                <button id="back-to-login-btn">Back</button>
            </div>
            
            <div id="scanner-view" class="card-view">
                <h3 id="welcome-message">Welcome, Hunter!</h3>
                <div id="qr-reader"></div>
                <button id="scanner-logout-btn">Log Out</button>
            </div>

        </div>
    </div>

    <footer>
        <img src="https://i.imgur.com/p2qZOL5.png" alt="Canyon Activities Board Logo" class="footer-logo">
        <p>Hosted By the Canyon Activities Board at Grand Canyon University</p>
    </footer>

    <script>
        // --- State and Element References ---
        let currentUserName = '';
        let html5QrCode = null;

        const allViews = document.querySelectorAll('.card-view');
        const loginView = document.getElementById('login-view');
        const registrationView = document.getElementById('registration-view');
        const howToPlayView = document.getElementById('how-to-play-view');
        const leaderboardView = document.getElementById('leaderboard-view');
        const scannerView = document.getElementById('scanner-view');

        const registerButton = document.getElementById('register-btn');
        const backButton = document.getElementById('back-btn');
        const signInButton = document.getElementById('signin-btn');
        const logoutButton = document.getElementById('logout-btn');
        const leaderboardLink = document.getElementById('leaderboard-link');
        const backToLoginButton = document.getElementById('back-to-login-btn');
        const submitButton = document.getElementById('submit-btn');
        const scannerLogoutButton = document.getElementById('scanner-logout-btn');
        
        const instructionsCard = document.getElementById('instructions-card');
        const closeInstructionsButton = document.getElementById('close-instructions');

        // --- QR Scanner Functions ---
        function onScanSuccess(decodedText, decodedResult) {
            // Handle the scanned code here. For now, we'll just alert it.
            alert(`QR Code Scanned! Result: ${decodedText}`);
            stopScanner();
            // You could switch to another view here, like a success screen
        }

        function startScanner() {
            if (!html5QrCode) {
                 html5QrCode = new Html5Qrcode("qr-reader");
            }
            html5QrCode.start(
                { facingMode: "environment" }, // Use the back camera
                {
                    fps: 10,    // Optional, frames per second
                    qrbox: { width: 250, height: 250 }  // Optional, size of scanning box
                },
                onScanSuccess)
            .catch(err => {
                console.log(`Unable to start scanning, error: ${err}`);
            });
        }

        function stopScanner() {
            if (html5QrCode && html5QrCode.isScanning) {
                html5QrCode.stop().then(() => {
                    console.log("QR Code scanning stopped.");
                }).catch(err => {
                    console.log(`Unable to stop scanning, error: ${err}`);
                });
            }
        }

        // --- View Switching Function ---
        function switchView(viewToShow) {
            stopScanner(); // Always try to stop the scanner when leaving a view
            allViews.forEach(view => view.classList.remove('active'));
            viewToShow.classList.add('active');
        }

        // --- Initial View ---
        switchView(loginView);

        // --- Event Listeners ---
        registerButton.addEventListener('click', () => switchView(registrationView));
        backButton.addEventListener('click', () => switchView(loginView));
        leaderboardLink.addEventListener('click', () => switchView(leaderboardView));
        backToLoginButton.addEventListener('click', () => switchView(loginView));
        
        const allLogoutButtons = [logoutButton, scannerLogoutButton];
        allLogoutButtons.forEach(btn => {
            btn.addEventListener('click', () => switchView(loginView));
        });

        signInButton.addEventListener('click', () => {
            const studentIdInput = document.getElementById('student-id-login');
            if (studentIdInput.value.trim() !== '') {
                // Update welcome message and switch to scanner
                const welcomeMsg = document.getElementById('welcome-message');
                welcomeMsg.textContent = `Welcome, ${currentUserName || 'Hunter'}!`;
                switchView(scannerView);
                startScanner(); // Start the camera
            } else {
                alert('Please enter your Student ID.');
            }
        });

        submitButton.addEventListener('click', () => {
            const firstNameInput = document.getElementById('reg-firstname');
            currentUserName = firstNameInput.value.trim();
            if(currentUserName){
                switchView(howToPlayView); // Go to "How to Play" after registering
            } else {
                alert("Please enter your first name.");
            }
        });

        closeInstructionsButton.addEventListener('click', () => {
            instructionsCard.style.display = 'none';
        });

    </script>

</body>
</html>
