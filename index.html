<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Zone Area Selector - Final</title>
    <style>
        :root {
            --card-bg: rgba(25, 25, 25, 0.7);
            --border-color: rgba(255, 255, 255, 0.2);
        }
        body { margin: 0; background-color: #000; color: white; font-family: system-ui, sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        h2 { text-align: center; margin: 1rem 0; }

        /* Map Container: Takes remaining height, anchors selection box */
        #map-container { 
            flex-grow: 1; 
            overflow: auto; 
            position: relative; 
            border-radius: 10px;
            margin: 0 1rem;
            cursor: crosshair; /* Indicates area selection mode */
        }
        
        /* Map Image: 300% zoom with scrolling */
        #map-container img { 
            width: 300%; 
            height: auto; 
            max-width: none;
            user-select: none;
        } 

        /* Visual Selection Box */
        .selection-box {
            position: absolute;
            border: 2px dashed #ff69b4;
            background-color: rgba(96, 163, 77, 0.3); /* Green tint */
            z-index: 90;
            pointer-events: none;
            box-sizing: border-box;
        }

        /* Styling for the permanent highlight */
        .highlighted-zone {
            border: 2px solid #00ff73; /* Solid green border for final highlight */
            background-color: rgba(96, 163, 77, 0.2); /* Lighter tint */
        }
    </style>
</head>
<body>
    <h2>Map Zone Area Selector (Click and Drag)</h2>
    <div id="map-container">
        <img id="mapImage" src="https://i.imgur.com/1aQCsPk.jpeg" alt="Campus Map">
    </div>
    <p style="text-align: center; font-size: 0.9em; margin: 1em;">Coordinates are printed to the Console (F12). Refresh the page to clear highlights.</p>

    <script>
        let startPoint = null;
        let currentSelection = null;
        const mapContainer = document.getElementById('map-container');
        const img = document.getElementById('mapImage');

        document.addEventListener('DOMContentLoaded', () => {
            mapContainer.addEventListener('mousedown', selectionStart);
            mapContainer.addEventListener('mousemove', selectionMove);
            mapContainer.addEventListener('mouseup', selectionEnd);
            console.log("Map Selector Ready. Click and drag on the map to define a zone.");
        });

        function selectionStart(e) {
            if (e.button !== 0) return; 

            const rect = mapContainer.getBoundingClientRect();
            const scrollX = mapContainer.scrollLeft;
            const scrollY = mapContainer.scrollTop;

            // Capture the starting point relative to the 300% image origin
            startPoint = {
                x: (e.clientX - rect.left) + scrollX,
                y: (e.clientY - rect.top) + scrollY,
            };
            
            // Create the visual selection box element
            if (!currentSelection) {
                currentSelection = document.createElement('div');
                currentSelection.className = 'selection-box';
                mapContainer.appendChild(currentSelection);
            } else {
                // If existing, just reuse and make it visible/reset
                currentSelection.style.display = 'block';
                currentSelection.classList.remove('highlighted-zone');
            }
            
            // Reset box dimensions and position
            currentSelection.style.width = '0px';
            currentSelection.style.height = '0px';
            currentSelection.style.left = `${startPoint.x}px`;
            currentSelection.style.top = `${startPoint.y}px`;

            e.preventDefault();
        }

        function selectionMove(e) {
            if (!startPoint || !currentSelection) return;

            const rect = mapContainer.getBoundingClientRect();
            const scrollX = mapContainer.scrollLeft;
            const scrollY = mapContainer.scrollTop;
            
            // Current mouse position relative to the 300% image origin
            const currentX = (e.clientX - rect.left) + scrollX;
            const currentY = (e.clientY - rect.top) + scrollY;

            // Calculate dimensions
            const width = currentX - startPoint.x;
            const height = currentY - startPoint.y;
            
            // Update the selection box position and size
            currentSelection.style.left = `${Math.min(startPoint.x, currentX)}px`;
            currentSelection.style.top = `${Math.min(startPoint.y, currentY)}px`;
            currentSelection.style.width = `${Math.abs(width)}px`;
            currentSelection.style.height = `${Math.abs(height)}px`;
        }

        function selectionEnd(e) {
            if (!startPoint || !currentSelection) return;

            // Get final mouse position
            const rect = mapContainer.getBoundingClientRect();
            const scrollX = mapContainer.scrollLeft;
            const scrollY = mapContainer.scrollTop;
            const endX = (e.clientX - rect.left) + scrollX;
            const endY = (e.clientY - rect.top) + scrollY;

            if (img.offsetWidth === 0) {
                currentSelection.remove();
                startPoint = null;
                return;
            }
            
            // Get final bounds in pixels
            const finalLeftPx = Math.min(startPoint.x, endX);
            const finalTopPx = Math.min(startPoint.y, endY);
            const finalRightPx = Math.max(startPoint.x, endX);
            const finalBottomPx = Math.max(startPoint.y, endY);
            
            // Convert to percentages relative to the 300% image size
            const imageWidth = img.offsetWidth;
            const imageHeight = img.offsetHeight;

            const percentLeft = (finalLeftPx / imageWidth) * 100;
            const percentTop = (finalTopPx / imageHeight) * 100;
            const percentRight = (finalRightPx / imageWidth) * 100;
            const percentBottom = (finalBottomPx / imageHeight) * 100;
            
            const percentWidth = percentRight - percentLeft;
            const percentHeight = percentBottom - percentTop;

            // Calculate the center point for standard pin placement
            const percentCenterX = percentLeft + (percentWidth / 2);
            const percentCenterY = percentTop + (percentHeight / 2);

            // ðŸš€ Keep the highlight and style it permanently
            currentSelection.classList.add('highlighted-zone');
            
            // Reset state for next selection
            startPoint = null;
            currentSelection = null; 
            
            // Report coordinates
            console.log(`
// --- AREA SELECTION FOR ZONE BOUNDARY ---

/* To place a PIN in the center of this area (Recommended): */
#zoneX {
    top: ${percentCenterY.toFixed(2)}%;
    left: ${percentCenterX.toFixed(2)}%;
    transform: translate(-50%, -50%); /* Centers the pin */
}

/* For defining the RECTANGULAR BOUNDARY itself: */
#zoneX_Boundary {
    top: ${percentTop.toFixed(2)}%;
    left: ${percentLeft.toFixed(2)}%;
    width: ${percentWidth.toFixed(2)}%;
    height: ${percentHeight.toFixed(2)}%;
}
            `);
        }
    </script>
</body>
</html>
